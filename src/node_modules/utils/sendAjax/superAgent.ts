import * as superagent from 'superagent';
import { message } from 'antd';

/**
 * 请求域名
 */
const getHost = () => {
    return window['$$_env'].URL;
};

/**
 * 向后台发送请求 调用superagent
 * @param type 请求类型 如:post get 
 * @param uri 请求地址
 * @param params 参数
 */
const call = (type: string, uri: string, params: any) => {
    return new Promise((resolve) => {
        const options = {
            'Content-Type': 'application/json',
        };

        superagent[type](getHost() + uri)
            .set(options)[type === 'get' ? 'query' : 'send'](params)
            .end((err, res) => {
                if (!err) {
                    // 请求成功 处理数据
                    resolve(res.body);
                } else {
                    message.error('系统错误!');
                }
            })
            .timeout(3000);
    });
};

export default call;